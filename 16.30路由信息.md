# 16.30 加密货币监控系统 - 容器化路由信息文档

## 文档概述
- **创建时间**: 2025年1月20日
- **目的**: 为项目容器化提供完整的路由信息梳理
- **适用范围**: Docker容器化部署配置
- **系统架构**: 前后端一体化Flask应用

## 一、前端页面路由 (Frontend Routes)

### 页面路由模块
| 路由路径 | HTTP方法 | 模板文件 | 功能描述 | 容器化注意事项 |
|---------|---------|----------|----------|----------------|
| `/` | GET | `templates/index.html` | 主页 - 加密货币概览和导航 | 静态资源路径需配置 |
| `/bitcoin` | GET | `templates/bitcoin.html` | 比特币详情页 - 图表和数据展示 | 依赖Chart.js CDN |
| `/ethereum` | GET | `templates/ethereum.html` | 以太坊详情页 - 图表和数据展示 | 依赖Chart.js CDN |
| `/kline` | GET | `templates/kline.html` | K线图页面 - 技术分析图表 | 依赖Chart.js CDN |

### 静态资源路由
| 资源类型 | 路由路径 | 物理路径 | 容器化配置 |
|---------|---------|----------|------------|
| CSS样式 | `/static/css/*` | `frontend/static/css/` | NGINX静态托管 |
| JavaScript | `/static/js/*` | `frontend/static/js/` | NGINX静态托管 |
| 图标文件 | `/static/icons/*` | `frontend/static/icons/` | NGINX静态托管 |
| 图片资源 | `/static/images/*` | `frontend/static/images/` | NGINX静态托管 |
| 网站图标 | `/favicon.ico` | `frontend/static/favicon.ico` | NGINX静态托管 |

## 二、后端API路由 (Backend API Routes)

### 核心数据API模块
| 路由路径 | HTTP方法 | 功能描述 | 返回格式 | 限流配置 | 数据库依赖 | 缓存依赖 |
|---------|---------|----------|----------|----------|------------|----------|
| `/api/health` | GET | 系统健康检查 | JSON | 无限制 | ❌ | ❌ |
| `/api/latest_prices` | GET | 获取BTC/ETH最新价格 | JSON | 30次/分钟 | ✅ | ✅ |
| `/api/price_history` | GET | 获取价格历史数据 | JSON | 20次/分钟 | ✅ | ✅ |
| `/api/chart_data` | GET | 获取图表绘制数据 | JSON | 20次/分钟 | ✅ | ✅ |

### 专用图表API模块
| 路由路径 | HTTP方法 | 参数 | 功能描述 | 数据库依赖 | 缓存依赖 |
|---------|---------|------|----------|------------|----------|
| `/api/btc_chart` | GET | `timeframe`, `limit` | 比特币专用图表数据 | ✅ | ✅ |
| `/api/eth_chart` | GET | `timeframe`, `limit` | 以太坊专用图表数据 | ✅ | ✅ |
| `/api/kline_chart` | GET | `symbol`, `timeframe` | K线图表数据 | ✅ | ✅ |

### 业务数据API模块
| 路由路径 | HTTP方法 | 功能描述 | 数据库依赖 | 缓存依赖 |
|---------|---------|----------|------------|----------|
| `/api/btc_data` | GET | 比特币详细数据 | ✅ | ✅ |
| `/api/eth_data` | GET | 以太坊详细数据 | ✅ | ✅ |
| `/api/kline_data` | GET | K线数据 | ✅ | ✅ |
| `/api/analysis` | GET | 技术分析报告 | ✅ | ✅ |

### 系统管理API模块
| 路由路径 | HTTP方法 | 功能描述 | 权限要求 | 数据库依赖 | 缓存依赖 |
|---------|---------|----------|----------|------------|----------|
| `/api/refresh_charts` | POST | 刷新所有图表数据 | 无 | ✅ | ✅ |
| `/api/system/status` | GET | 获取系统运行状态 | 无 | ✅ | ✅ |
| `/api/cache/stats` | GET | 获取缓存使用统计 | 无 | ❌ | ✅ |
| `/api/cache/clear` | POST | 清除系统缓存 | 无 | ❌ | ✅ |

## 三、容器化网络配置

### 服务间通信路由
| 服务名称 | 内部端口 | 外部端口 | 网络名称 | 依赖服务 |
|---------|---------|----------|----------|----------|
| frontend-backend | 8000 | - | crypto_network | database, redis |
| database | 3306 | - | crypto_network | - |
| redis | 6379 | - | crypto_network | - |
| nginx | 80 | 80 | crypto_network | frontend-backend |

### NGINX代理配置
```nginx
# 前端页面代理
location / {
    proxy_pass http://frontend-backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

# API接口代理
location /api/ {
    proxy_pass http://frontend-backend:8000;
    proxy_set_header Host $host;
    proxy_set_header X-Real-IP $remote_addr;
}

# 静态资源直接托管
location /static/ {
    alias /usr/share/nginx/html/static/;
    expires 1d;
    add_header Cache-Control "public, immutable";
}
```

## 四、数据库路由映射

### 数据表访问路由
| API路由 | 数据表 | 操作类型 | 索引字段 |
|---------|--------|----------|----------|
| `/api/latest_prices` | `crypto_prices` | SELECT | `timestamp` |
| `/api/price_history` | `crypto_prices` | SELECT | `crypto_symbol`, `timestamp` |
| `/api/chart_data` | `crypto_prices` | SELECT | `crypto_symbol`, `timestamp` |
| `/api/btc_chart` | `crypto_prices` | SELECT | `crypto_symbol='BTC'`, `timestamp` |
| `/api/eth_chart` | `crypto_prices` | SELECT | `crypto_symbol='ETH'`, `timestamp` |
| `/api/kline_chart` | `crypto_prices` | SELECT | `crypto_symbol`, `timestamp` |

## 五、缓存路由策略

### Redis缓存键值映射
| API路由 | 缓存键 | 过期时间 | 更新策略 |
|---------|--------|----------|----------|
| `/api/latest_prices` | `latest_prices` | 60秒 | 定时更新 |
| `/api/chart_data` | `chart_data:{symbol}:{timeframe}` | 300秒 | 按需更新 |
| `/api/btc_chart` | `btc_chart:{timeframe}` | 300秒 | 按需更新 |
| `/api/eth_chart` | `eth_chart:{timeframe}` | 300秒 | 按需更新 |

## 六、错误处理路由

### HTTP错误处理
| 错误码 | 处理器 | 返回格式 | 日志级别 |
|--------|--------|----------|----------|
| 404 | `not_found` | JSON | INFO |
| 500 | `internal_error` | JSON | ERROR |
| 429 | `rate_limit_exceeded` | JSON | WARN |

## 七、容器化部署检查清单

### 路由验证项目
- [ ] 前端页面路由可访问性
- [ ] API接口路由响应正确性
- [ ] 静态资源路由加载正常
- [ ] 数据库连接路由正常
- [ ] Redis缓存路由正常
- [ ] NGINX代理路由配置正确
- [ ] 服务间网络路由通畅
- [ ] 错误处理路由功能正常

### 性能监控路由
- [ ] `/api/health` - 健康检查
- [ ] `/api/system/status` - 系统状态
- [ ] `/api/cache/stats` - 缓存统计

---

**文档版本**: v1.0  
**最后更新**: 2025年1月20日  
**适用环境**: Docker容器化部署  
**维护人员**: 开发团队